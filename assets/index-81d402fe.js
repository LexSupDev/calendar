(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function c(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=c(a);fetch(a.href,i)}})();function S(l){let t=new Set,c=new Set,s=new Set,a=new Set;l.Events.forEach(e=>{t.add(e.startTime),c.add(e.duration),s.add(e.location),a.add(e.participants.join(","))});const i=document.querySelector("#filterStartTime"),r=document.querySelector("#filterDuration"),n=document.querySelector("#filterLocation"),u=document.querySelector("#filterParticipants");i.innerHTML='<option value="" class="startTime__listItem">Все</option>',r.innerHTML='<option value="" class="duration__listItem">Все</option>',n.innerHTML='<option value="" class="location__listItem">Все</option>',u.innerHTML='<option value="" class="participant__listItem">Все</option>',t.forEach(e=>{let o=`<option value="${e}" class="startTime__listItem">${e}</option>`;i.innerHTML+=o}),Array.from(c).sort((e,o)=>e-o).forEach(e=>{let o=`<option value="${e}" class="duration__listItem">${e}</option>`;r.innerHTML+=o}),s.forEach(e=>{let o=`<option value="${e}" class="location__listItem">${e}</option>`;n.innerHTML+=o}),a.forEach(e=>{let o=`<option value="${e}" class="participants__listItem">${e}</option>`;u.innerHTML+=o})}function T(l){const t=document.querySelector("#filterStartTime"),c=document.querySelector("#filterDuration"),s=document.querySelector("#filterLocation"),a=document.querySelector("#filterParticipants"),i=e(t,"startTime"),r=e(c,"duration"),n=e(a,"participants"),u=e(s,"location");function e(m,v){return function(f){return m.value?typeof f[v]=="object"?f[v].join(",")===m.value:f[v]===m.value:!0}}let o=d();function d(){return{Events:l.Events.slice(0).filter(i).filter(r).filter(u).filter(n)}}return o.Events}function I(l,t){document.querySelector(".filters__wrapper").addEventListener("change",()=>{E(l,t)})}function q(){return localStorage.getItem("eventsList")?JSON.parse(localStorage.getItem("eventsList")):{Events:[{title:"Соревнование по лёгкой атлетике",date:"2023-03-15",startTime:"14:30",duration:"4",location:"Бауманская",participants:["Тренер","Мартышка"]},{title:"Воллейбол",date:"2023-03-16",startTime:"12:30",duration:"1",location:"Сокольники",participants:["Саня","Яна"]}]}}function y(l){localStorage.setItem("eventsList",JSON.stringify(l))}function h(l){const t=document.querySelector(".events__date");t.innerHTML=l.toLocaleString("ru-ru",{month:"long",day:"numeric",year:"numeric"})}function E(l,t){let c=T(l),s={Events:[]};function a(r,n){let u={Events:[]};return r.forEach(e=>{let o=new Date(e.date);n.getDate()===o.getDate()&&n.getMonth()===o.getMonth()&&n.getFullYear()===o.getFullYear()&&u.Events.push(e)}),u}s=a(c,t);const i=document.querySelector(".events__list");i.innerHTML="",s.Events.forEach(r=>{let n=`<article class="events_listItem eventItem"><div class="eventItem__controlBlock"><span class="eventItem__controlItem btn btn--save collapse"></span><span class="eventItem__controlItem btn btn--edit"></span>
      <span class="eventItem__controlItem btn btn--del"></span>
      </div>
    <p class="eventItem__title">${r.title}</p>                                                             
    <div class="eventItem__row">                                                                                                
    <span class="eventItem__startTime">Время начала: <span class="eventItem__startTimeSpan">${r.startTime}</span></span>                      
    <span class="eventItem__duration">\\ Длительность: <span class="eventItem__durationSpan">${r.duration}</span></span>              
    </div>                                                                                                                      
    <p class="eventItem__location">Место: <span class="eventItem__locationSpan">${r.location}</span></p>                               
    <p class="eventItem__participants">Участники: 
    <span class="eventItem__participantsSpan">${r.participants.join(",")}</span></p></article>`;i.innerHTML+=n}),S(a(l.Events,t)),L(s,l,t)}function L(l,t,c){const s=document.querySelectorAll(".btn--edit"),a=document.querySelectorAll(".btn--del"),i=document.querySelectorAll(".btn--save");a.forEach((r,n)=>{r.addEventListener("click",u=>{let e=0;t.Events.forEach((o,d)=>{if(JSON.stringify(o)===JSON.stringify(l.Events[n]))for(;e<1;)e++,console.log("Удалил"),t.Events.splice(d,1),y(t),S(t),p(t,c),E(t,c)})})}),s.forEach((r,n)=>{r.addEventListener("click",u=>{u.preventDefault(),r.classList.add("collapse"),i[n].classList.remove("collapse");let e=u.target.parentElement.parentElement,o=e.querySelector(".eventItem__title"),d=e.querySelector(".eventItem__startTimeSpan"),m=e.querySelector(".eventItem__durationSpan"),v=e.querySelector(".eventItem__locationSpan"),f=e.querySelector(".eventItem__participantsSpan");o.innerHTML=`<input type="text" value="${o.textContent}">`,d.innerHTML=`<input type="time" value="${d.textContent}">`,m.innerHTML=`<input type="text" value="${m.textContent}">`,v.innerHTML=`<input type="text" value="${v.textContent}">`,f.innerHTML=`<input type="text" value="${f.textContent}">`,i[n].addEventListener("click",g=>{g.preventDefault(),t.Events.forEach((D,_)=>{JSON.stringify(D)===JSON.stringify(l.Events[n])&&(t.Events[_].title=o.children[0].value,t.Events[_].startTime=d.children[0].value,t.Events[_].duration=m.children[0].value,t.Events[_].location=v.children[0].value,t.Events[_].participants=f.children[0].value.split(","),y(t),S(t),p(t,c),E(t,c))})})})})}function w(){function l(){const c=document.querySelector(".events__addPopup");c.classList.contains("collapse")?c.classList.remove("collapse"):c.classList.add("collapse")}document.querySelector(".events__addButton").addEventListener("click",l)}function M(l){const t=document.querySelector("#event-title"),c=document.querySelector("#event-date"),s=document.querySelector("#event-startTime"),a=document.querySelector("#event-duration"),i=document.querySelector("#event-location"),r=document.querySelector("#event-participants");l.Events.push({title:t.value,date:c.value,startTime:s.value,duration:a.value,location:i.value,participants:r.value.split(",")})}function H(l){function t(s,a,i){s.preventDefault(),M(a),y(a),S(a),p(a,i),E(a,i)}document.querySelector(".addEventPopup__form").addEventListener("submit",s=>{t(s,l,p.activeDate)})}function p(l,t){function c(){const r=document.querySelector("#calendar");let n=new Date(new Date().getFullYear(),new Date().getMonth());const u=t.getDate(),e=n.getMonth();let o="<table class='calendar__table table table-bordered JS-calendar'><thead><th>пн</th><th>вт</th><th>ср</th><th>чт</th><th>пт</th><th>сб</th><th>вс</th></thead><tr>";for(let d=1;d<n.getDay();d++)o+="<td></td>";for(;n.getMonth()===e;)s(n,l)&&n.getDate()===u?o+="<td class='table-active has-event'>"+n.getDate()+"</td>":n.getDate()===u?o+="<td class='table-active'>"+n.getDate()+"</td>":s(n,l)?o+="<td class='has-event'>"+n.getDate()+"</td>":o+="<td>"+n.getDate()+"</td>",n.getDay()%7===0&&(o+="</tr><tr>"),n.setDate(n.getDate()+1);if(n.getDay()!==0)for(let d=n.getDay();d<=7;d++)o+="<td></td>";o+="</tr></table>",r.innerHTML=o}function s(r,n){return!!n.Events.filter(e=>new Date(e.date).getDate()===r.getDate()&&new Date(e.date).getMonth()===r.getMonth()&&new Date(e.date).getFullYear()===r.getFullYear()).length}function a(r){const n=r.currentTarget.querySelectorAll("td"),u=r.target.textContent;t=new Date(new Date().setDate(u)),p.activeDate=t,n.forEach(e=>e.classList.remove("table-active")),u&&r.target.tagName==="TD"&&r.target.classList.add("table-active"),h(t),E(l,t)}c(),document.querySelector(".JS-calendar").addEventListener("click",a)}function $(){let l=q();p.activeDate=new Date,p(l,p.activeDate),h(p.activeDate),E(l,p.activeDate),I(l,p.activeDate),w(),H(l),y(l)}$();
