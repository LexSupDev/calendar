(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function c(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerpolicy&&(l.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?l.credentials="include":n.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(n){if(n.ep)return;n.ep=!0;const l=c(n);fetch(n.href,l)}})();function S(a){const t=document.querySelector("#filterStartTime"),c=document.querySelector("#filterDuration"),s=document.querySelector("#filterLocation"),n=document.querySelector("#filterParticipants");t.innerHTML='<option value="" class="startTime__listItem">Все</option>',c.innerHTML='<option value="" class="duration__listItem">Все</option>',s.innerHTML='<option value="" class="location__listItem">Все</option>',n.innerHTML='<option value="" class="participant__listItem">Все</option>';let l=new Set,r=new Set,e=new Set,u=new Set;a.Events.forEach(i=>{l.add(i.startTime),r.add(i.duration),e.add(i.location),u.add(i.participants.join(","))});function o(i,d,f){Array.from(i).sort((p,m)=>p-m).forEach(p=>{let m=`<option value="${p}" class=${f}>${p}</option>`;d.innerHTML+=m})}o(l,t,"startTime__listItem"),o(r,c,"duration__listItem"),o(e,s,"location__listItem"),o(u,n,"participants__listItem")}function I(a){const t=document.querySelector("#filterStartTime"),c=document.querySelector("#filterDuration"),s=document.querySelector("#filterLocation"),n=document.querySelector("#filterParticipants"),l=o(t,"startTime"),r=o(c,"duration"),e=o(n,"participants"),u=o(s,"location");function o(f,p){return function(m){return f.value?typeof m[p]=="object"?m[p].join(",")===f.value:m[p]===f.value:!0}}let i=d();function d(){return{Events:a.Events.slice(0).filter(l).filter(r).filter(u).filter(e)}}return i.Events}function q(a,t){document.querySelector(".filters__wrapper").addEventListener("change",()=>{E(a,t)})}function L(){return localStorage.getItem("eventsList")?JSON.parse(localStorage.getItem("eventsList")):{Events:[{title:"Соревнование по лёгкой атлетике",date:"2023-03-15",startTime:"14:30",duration:"4",location:"Бауманская",participants:["Тренер","Мартышка"]},{title:"Воллейбол",date:"2023-03-16",startTime:"12:30",duration:"1",location:"Сокольники",participants:["Саня","Яна"]}]}}function y(a){localStorage.setItem("eventsList",JSON.stringify(a))}function g(a){const t=document.querySelector(".events__date");t.innerHTML=a.toLocaleString("ru-RU",{month:"long",day:"numeric",year:"numeric"})}function E(a,t){let c=I(a);function s(r,e){let u={Events:[]};return r.forEach(o=>{let i=new Date(o.date);e.getDate()===i.getDate()&&e.getMonth()===i.getMonth()&&e.getFullYear()===i.getFullYear()&&u.Events.push(o)}),u}let n=s(c,t);const l=document.querySelector(".events__list");l.innerHTML="",n.Events.forEach(r=>{let e=`<article class="events_listItem eventItem"><div class="eventItem__controlBlock"><span class="eventItem__controlItem btn btn--save collapse"></span><span class="eventItem__controlItem btn btn--edit"></span>
      <span class="eventItem__controlItem btn btn--del"></span>
      </div>
    <p class="eventItem__title">${r.title}</p>                                                             
    <div class="eventItem__row">                                                                                                
    <span class="eventItem__startTime">Время начала: <span class="eventItem__startTimeSpan">${r.startTime}</span></span>                      
    <span class="eventItem__duration">\\ Длительность: <span class="eventItem__durationSpan">${r.duration}</span></span>              
    </div>                                                                                                                      
    <p class="eventItem__location">Место: <span class="eventItem__locationSpan">${r.location}</span></p>                               
    <p class="eventItem__participants">Участники: 
    <span class="eventItem__participantsSpan">${r.participants.join(",")}</span></p></article>`;l.innerHTML+=e}),S(s(a.Events,t)),w(n,a,t)}function w(a,t,c){const s=document.querySelectorAll(".btn--edit"),n=document.querySelectorAll(".btn--del"),l=document.querySelectorAll(".btn--save");n.forEach((r,e)=>{r.addEventListener("click",()=>{let u=0;t.Events.forEach((o,i)=>{if(JSON.stringify(o)===JSON.stringify(a.Events[e]))for(;u<1;)u++,console.log("Удалил"),t.Events.splice(i,1),y(t),S(t),v(t,c),E(t,c)})})}),s.forEach((r,e)=>{r.addEventListener("click",u=>{u.preventDefault(),r.classList.add("collapse"),l[e].classList.remove("collapse");let o=u.target.parentElement.parentElement,i=o.querySelector(".eventItem__title"),d=o.querySelector(".eventItem__startTimeSpan"),f=o.querySelector(".eventItem__durationSpan"),p=o.querySelector(".eventItem__locationSpan"),m=o.querySelector(".eventItem__participantsSpan");i.innerHTML=`<input type="text" value="${i.textContent}">`,d.innerHTML=`<input type="time" value="${d.textContent}">`,f.innerHTML=`<input type="text" value="${f.textContent}">`,p.innerHTML=`<input type="text" value="${p.textContent}">`,m.innerHTML=`<input type="text" value="${m.textContent}">`,l[e].addEventListener("click",D=>{D.preventDefault();let h=0;t.Events.forEach((T,_)=>{if(JSON.stringify(T)===JSON.stringify(a.Events[e]))for(;h<1;)h++,t.Events[_].title=i.children[0].value,t.Events[_].startTime=d.children[0].value,t.Events[_].duration=f.children[0].value,t.Events[_].location=p.children[0].value,t.Events[_].participants=m.children[0].value.split(","),y(t),S(t),v(t,c),E(t,c)})})})})}function M(){function a(){const c=document.querySelector(".events__addPopup");c.classList.contains("collapse")?c.classList.remove("collapse"):c.classList.add("collapse")}document.querySelector(".events__addButton").addEventListener("click",a)}function F(a){const t=document.querySelector("#event-title"),c=document.querySelector("#event-date"),s=document.querySelector("#event-startTime"),n=document.querySelector("#event-duration"),l=document.querySelector("#event-location"),r=document.querySelector("#event-participants");a.Events.push({title:t.value,date:c.value,startTime:s.value,duration:n.value,location:l.value,participants:r.value.split(",")})}function H(a){function t(s,n,l){s.preventDefault(),F(n),y(n),S(n),v(n,l),E(n,l)}document.querySelector(".addEventPopup__form").addEventListener("submit",s=>{t(s,a,v.activeDate)})}function v(a,t){function c(){const r=document.querySelector("#calendar");let e=new Date(new Date().getFullYear(),new Date().getMonth());const u=t.getDate(),o=e.getMonth();let i="<table class='calendar__table table table-bordered JS-calendar'><thead><th>пн</th><th>вт</th><th>ср</th><th>чт</th><th>пт</th><th>сб</th><th>вс</th></thead><tr>";for(let d=1;d<e.getDay();d++)i+="<td></td>";for(;e.getMonth()===o;)s(e,a)&&e.getDate()===u?i+="<td class='table-active has-event'>"+e.getDate()+"</td>":e.getDate()===u?i+="<td class='table-active'>"+e.getDate()+"</td>":s(e,a)?i+="<td class='has-event'>"+e.getDate()+"</td>":i+="<td>"+e.getDate()+"</td>",e.getDay()%7===0&&(i+="</tr><tr>"),e.setDate(e.getDate()+1);if(e.getDay()!==0)for(let d=e.getDay();d<=7;d++)i+="<td></td>";i+="</tr></table>",r.innerHTML=i}function s(r,e){return!!e.Events.filter(o=>new Date(o.date).getDate()===r.getDate()&&new Date(o.date).getMonth()===r.getMonth()&&new Date(o.date).getFullYear()===r.getFullYear()).length}function n(r){const e=r.currentTarget.querySelectorAll("td"),u=r.target.textContent;t=new Date(new Date().setDate(u)),v.activeDate=t,e.forEach(o=>o.classList.remove("table-active")),u&&r.target.tagName==="TD"&&r.target.classList.add("table-active"),g(t),E(a,t)}c(),document.querySelector(".JS-calendar").addEventListener("click",n)}function P(){let a=L();v.activeDate=new Date,v(a,v.activeDate),q(a,v.activeDate),M(),H(a),S(a),E(a,v.activeDate),g(v.activeDate),y(a)}P();
