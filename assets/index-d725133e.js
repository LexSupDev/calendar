(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}})();function S(n){let t=new Set,s=new Set,c=new Set,a=new Set;n.Events.forEach(e=>{t.add(e.startTime),s.add(e.duration),c.add(e.location),a.add(e.participants.join(","))});const r=document.querySelector("#filterStartTime"),l=document.querySelector("#filterDuration"),o=document.querySelector("#filterLocation"),u=document.querySelector("#filterParticipants");r.innerHTML='<option value="" class="startTime__listItem">Все</option>',l.innerHTML='<option value="" class="duration__listItem">Все</option>',o.innerHTML='<option value="" class="location__listItem">Все</option>',u.innerHTML='<option value="" class="participant__listItem">Все</option>',t.forEach(e=>{let i=`<option value="${e}" class="startTime__listItem">${e}</option>`;r.innerHTML+=i}),Array.from(s).sort((e,i)=>e-i).forEach(e=>{let i=`<option value="${e}" class="duration__listItem">${e}</option>`;l.innerHTML+=i}),c.forEach(e=>{let i=`<option value="${e}" class="location__listItem">${e}</option>`;o.innerHTML+=i}),a.forEach(e=>{let i=`<option value="${e}" class="participants__listItem">${e}</option>`;u.innerHTML+=i})}function I(n){const t=document.querySelector("#filterStartTime"),s=document.querySelector("#filterDuration"),c=document.querySelector("#filterLocation"),a=document.querySelector("#filterParticipants"),r=e(t,"startTime"),l=e(s,"duration"),o=e(a,"participants"),u=e(c,"location");function e(m,v){return function(f){return m.value?typeof f[v]=="object"?f[v].join(",")===m.value:f[v]===m.value:!0}}let i=p();function p(){return{Events:n.Events.slice(0).filter(r).filter(l).filter(u).filter(o)}}return i.Events}function h(n,t){document.querySelector(".filters__wrapper").addEventListener("change",()=>{E(n,t)})}function q(){return localStorage.getItem("eventsList")?JSON.parse(localStorage.getItem("eventsList")):{Events:[{title:"Соревнование по лёгкой атлетике",date:"2023-03-15",startTime:"14:30",duration:"4",location:"Бауманская",participants:["Тренер","Мартышка"]},{title:"Воллейбол",date:"2023-03-16",startTime:"12:30",duration:"1",location:"Сокольники",participants:["Саня","Яна"]}]}}function y(n){localStorage.setItem("eventsList",JSON.stringify(n))}function g(n){const t=document.querySelector(".events__date");t.innerHTML=n.toLocaleString("ru-ru",{month:"long",day:"numeric",year:"numeric"})}function E(n,t){let s=I(n),c={Events:[]};s.forEach(r=>{let l=new Date(r.date);t.getDate()===l.getDate()&&t.getMonth()===l.getMonth()&&t.getFullYear()===l.getFullYear()&&c.Events.push(r)});const a=document.querySelector(".events__list");a.innerHTML="",c.Events.forEach(r=>{let l=`<article class="events_listItem eventItem"><div class="eventItem__controlBlock"><span class="eventItem__controlItem btn btn--save collapse"></span><span class="eventItem__controlItem btn btn--edit"></span>
      <span class="eventItem__controlItem btn btn--del"></span>
      </div>
    <p class="eventItem__title">${r.title}</p>                                                             
    <div class="eventItem__row">                                                                                                
    <span class="eventItem__startTime">Время начала: <span class="eventItem__startTimeSpan">${r.startTime}</span></span>                      
    <span class="eventItem__duration">\\ Длительность: <span class="eventItem__durationSpan">${r.duration}</span></span>              
    </div>                                                                                                                      
    <p class="eventItem__location">Место: <span class="eventItem__locationSpan">${r.location}</span></p>                               
    <p class="eventItem__participants">Участники: 
    <span class="eventItem__participantsSpan">${r.participants.join(",")}</span></p></article>`;a.innerHTML+=l}),L(c,n,t)}function L(n,t,s){const c=document.querySelectorAll(".btn--edit"),a=document.querySelectorAll(".btn--del"),r=document.querySelectorAll(".btn--save");a.forEach((l,o)=>{l.addEventListener("click",u=>{u.target.parentElement.parentElement.remove(),t.Events.forEach((e,i)=>{JSON.stringify(e)===JSON.stringify(n.Events[o])&&(t.Events.splice(i,1),y(t),S(t),d(t,s),E(t,s))})})}),c.forEach((l,o)=>{l.addEventListener("click",u=>{u.preventDefault(),l.classList.add("collapse"),r[o].classList.remove("collapse");let e=u.target.parentElement.parentElement,i=e.querySelector(".eventItem__title"),p=e.querySelector(".eventItem__startTimeSpan"),m=e.querySelector(".eventItem__durationSpan"),v=e.querySelector(".eventItem__locationSpan"),f=e.querySelector(".eventItem__participantsSpan");i.innerHTML=`<input type="text" value="${i.textContent}">`,p.innerHTML=`<input type="time" value="${p.textContent}">`,m.innerHTML=`<input type="text" value="${m.textContent}">`,v.innerHTML=`<input type="text" value="${v.textContent}">`,f.innerHTML=`<input type="text" value="${f.textContent}">`,r[o].addEventListener("click",D=>{D.preventDefault(),t.Events.forEach((T,_)=>{JSON.stringify(T)===JSON.stringify(n.Events[o])&&(t.Events[_].title=i.children[0].value,t.Events[_].startTime=p.children[0].value,t.Events[_].duration=m.children[0].value,t.Events[_].location=v.children[0].value,t.Events[_].participants=f.children[0].value.split(","),y(t),S(t),d(t,s),E(t,s))})})})})}function M(){const n=document.querySelector(".events__addPopup");n.classList.contains("collapse")?n.classList.remove("collapse"):n.classList.add("collapse")}function w(n){const t=document.querySelector("#event-title"),s=document.querySelector("#event-date"),c=document.querySelector("#event-startTime"),a=document.querySelector("#event-duration"),r=document.querySelector("#event-location"),l=document.querySelector("#event-participants");n.Events.push({title:t.value,date:s.value,startTime:c.value,duration:a.value,location:r.value,participants:l.value.split(",")})}function H(n){function t(c,a,r){c.preventDefault(),w(a),y(a),S(a),d(a,r),E(a,r)}const s=document.querySelector(".addEventPopup__form");console.log(d.activeDate),s.addEventListener("submit",c=>{t(c,n,d.activeDate)})}const $=document.querySelector(".events__addButton");$.addEventListener("click",M);function d(n,t){function s(){const l=document.querySelector("#calendar");let o=new Date(new Date().getFullYear(),new Date().getMonth());const u=t.getDate(),e=o.getMonth();let i="<table class='calendar__table table table-bordered JS-calendar'><thead><th>пн</th><th>вт</th><th>ср</th><th>чт</th><th>пт</th><th>сб</th><th>вс</th></thead><tr>";for(let p=1;p<o.getDay();p++)i+="<td></td>";for(;o.getMonth()===e;)c(o,n)&&o.getDate()===u?i+="<td class='table-active has-event'>"+o.getDate()+"</td>":o.getDate()===u?i+="<td class='table-active'>"+o.getDate()+"</td>":c(o,n)?i+="<td class='has-event'>"+o.getDate()+"</td>":i+="<td>"+o.getDate()+"</td>",o.getDay()%7===0&&(i+="</tr><tr>"),o.setDate(o.getDate()+1);if(o.getDay()!==0)for(let p=o.getDay();p<=7;p++)i+="<td></td>";i+="</tr></table>",l.innerHTML=i}function c(l,o){return!!o.Events.filter(e=>new Date(e.date).getDate()===l.getDate()&&new Date(e.date).getMonth()===l.getMonth()&&new Date(e.date).getFullYear()===l.getFullYear()).length}function a(l){const o=l.currentTarget.querySelectorAll("td"),u=l.target.textContent;t=new Date(new Date().setDate(u)),d.activeDate=t,o.forEach(e=>e.classList.remove("table-active")),u&&l.target.tagName==="TD"&&l.target.classList.add("table-active"),g(t),E(n,t)}s(),document.querySelector(".JS-calendar").addEventListener("click",a)}function F(){let n=q();d.activeDate=new Date,d(n,d.activeDate),g(d.activeDate),E(n,d.activeDate),h(n,d.activeDate),S(n),h(n,d.activeDate),H(n),y(n)}F();
